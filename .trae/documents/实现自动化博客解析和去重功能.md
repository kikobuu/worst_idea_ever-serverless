# 实现自动化博客解析和去重功能

## 项目分析
- 博客系统基于Next.js 16.1.1，使用React 19.2.3
- 博客内容存放在`content/blog`目录，每个博客为独立子目录，包含`meta.json`和多语言`.md`文件
- 使用`react-markdown`和`mermaid`库处理Markdown和Mermaid图表

## 实现计划

### 1. 安装依赖
- 安装压缩包处理库：`adm-zip`用于解压zip文件

### 2. 创建目录结构
- 创建`content/pak`目录用于存放博客压缩包

### 3. 实现核心功能模块

#### 3.1 压缩包解析器
- **文件路径**：`src/lib/blog-parser.ts`
- **功能**：
  - 扫描`content/pak`目录下的压缩包
  - 解压压缩包到临时目录
  - 验证解压文件有效性
  - 处理验证结果

#### 3.2 文件有效性验证器
- **功能**：
  - 验证`meta.json`格式和内容完整性
  - 验证Markdown文件语法正确性
  - 验证Mermaid图表能否正确解析
  - （可选）预渲染测试

#### 3.3 博客去重机制
- **功能**：
  - 比较新博客与现有博客的文件名
  - 比较`meta.json`内容一致性
  - 基于修改时间选择保留较新的博客
  - 覆盖或删除旧博客文件

#### 3.4 自动执行机制
- **实现方式**：
  - 在开发模式下：使用文件系统监听器实时监控`content/pak`目录
  - 在生产构建时：作为构建前的预处理步骤

### 4. 实现步骤

1. **安装依赖**
   ```bash
   npm install adm-zip
   ```

2. **创建目录**
   ```bash
   mkdir -p content/pak
   ```

3. **实现博客解析器** (`src/lib/blog-parser.ts`)
   - 实现压缩包扫描和解压功能
   - 实现文件有效性验证
   - 实现结果处理逻辑

4. **实现去重机制**
   - 实现博客文件比较功能
   - 实现基于时间的文件替换逻辑

5. **集成到构建流程**
   - 修改`package.json`添加预处理脚本
   - 实现开发模式下的文件监听

6. **测试验证**
   - 创建测试压缩包验证功能正确性
   - 测试去重功能
   - 测试无效文件处理

### 5. 代码实现要点

- 使用`fs`和`path`模块处理文件系统操作
- 使用`adm-zip`处理压缩包
- 实现异步处理避免阻塞主线程
- 添加适当的错误处理和日志记录
- 确保代码可维护性和扩展性

### 6. 预期效果

- 在`content/pak`目录放入博客压缩包后，系统自动解析
- 有效博客会被解压到`content/blog`目录，原压缩包被删除
- 无效博客的解压目录会被删除，原压缩包添加`.fail`后缀
- 同名同内容的博客会根据时间戳自动去重，保留最新版本